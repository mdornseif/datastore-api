<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Dstore | datastore-api</title><meta name="description" content="Documentation for datastore-api"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script async src="../assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">datastore-api</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><ul class="tsd-breadcrumb"><li><a href="../modules.html">datastore-api</a></li><li><a href="Dstore.html">Dstore</a></li></ul><h1>Class Dstore</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><section class="tsd-panel tsd-comment"><div class="tsd-comment tsd-typography"><div class="lead">
<p>Dstore implements a slightly more accessible version of the <a href="https://cloud.google.com/nodejs/docs/reference/datastore/latest">Google Cloud Datastore: Node.js Client</a></p>
</div><div><p><a href="https://github.com/googleapis/nodejs-datastore#readme">@google-cloud/datastore</a> is a strange beast: <a href="https://cloud.google.com/nodejs/docs/reference/datastore/latest">The documentation is auto generated</a> and completely shy of documenting any advanced concepts.
(Example: If you ask the datastore to auto-generate keys during save: how do you retrieve the generated key?) Generally I suggest to look at the Python 2.x <a href="https://cloud.google.com/appengine/docs/standard/python/datastore/api-overview">db</a> and <a href="https://cloud.google.com/appengine/docs/standard/python/ndb">ndb</a> documentation to get a better explanation of the workings of the datastore.</p>
<p>Also the typings are strange. The Google provided type <code>Entities</code> can be the on disk representation, the same but including a key reference (<code>Datastore.KEY</code> - <a href="../modules.html#DstoreEntry">DstoreEntry</a>), a list of these  or a structured object containing the on disk representation under the <code>data</code> property and a <code>key</code> property and maybe some configuration like <code>excludeFromIndexes</code> (<a href="../modules.html#DstoreSaveEntity">DstoreSaveEntity</a>) or a list of these.</p>
<p>KvStore tries to abstract away most surprises the datastore provides to you but als tries to stay as API compatible as possible to <a href="https://github.com/googleapis/nodejs-datastore">@google-cloud/datastore</a>.</p>
<p>Main differences:</p>
<ul>
<li>Everything asynchronous is Promise-based - no callbacks.</li>
<li><a href="Dstore.html#get">get</a> always returns a single <a href="../modules.html#DstoreEntry">DstoreEntry</a>.</li>
<li><a href="Dstore.html#getMulti">getMulti</a> always returns an Array&lt;<a href="../modules.html#DstoreEntry">DstoreEntry</a>&gt; of the same length as the input Array. Items not found are represented by null.</li>
<li><a href="Dstore.html#set">set</a> is called with <code>(key, value)</code> and always returns the complete [[Key]] of the entity being written. Keys are normalized, numeric IDs are always encoded as strings.</li>
<li><a href="Dstore.html#key">key</a> handles [[Key]] object instantiation for you.</li>
<li><a href="Dstore.html#readKey">readKey</a> extracts the key from an <a href="../modules.html#DstoreEntry">DstoreEntry</a> you have read without the need of fancy <code>Symbol</code>-based access to <code>entity[Datastore.KEY]</code>. If needed, it tries to deserialize <code>_keyStr</code> to create <code>entity[Datastore.KEY]</code>. This ist important when rehydrating an <a href="../modules.html#DstoreEntry">DstoreEntry</a> from a serializing cache.</li>
<li><a href="Dstore.html#allocateOneId">allocateOneId</a> returns a single numeric string encoded unique datastore id without the need of fancy unpacking.</li>
<li><a href="Dstore.html#runInTransaction">runInTransaction</a> allows you to provide a function to be executed inside an transaction without the need of passing around the transaction object. This is modelled after Python 2.7 <a href="https://cloud.google.com/appengine/docs/standard/python/ndb/transactions">ndb&#39;s <code>@ndb.transactional</code> feature</a>. This is implemented via node&#39;s <a href="https://nodejs.org/docs/latest-v14.x/api/async_hooks.html">AsyncLocalStorage</a>.</li>
<li><a href="Dstore.html#keySerialize">keySerialize</a> is synchronous.</li>
</ul>
<p>This documentation also tries to document the little known idiosyncrasies of the <a href="https://github.com/googleapis/nodejs-datastore">@google-cloud/datastore</a> library. See the corresponding functions.</p>
</div></div></section><section class="tsd-panel tsd-hierarchy"><h3>Hierarchy</h3><ul class="tsd-hierarchy"><li><span class="target">Dstore</span></li></ul></section><section class="tsd-panel"><h3>Implements</h3><ul class="tsd-hierarchy"><li><span class="tsd-signature-type">IDstore</span></li></ul></section><section class="tsd-panel-group tsd-index-group"><h2>Index</h2><section class="tsd-panel tsd-index-panel"><div class="tsd-index-content"><section class="tsd-index-section "><h3>Constructors</h3><ul class="tsd-index-list"><li class="tsd-kind-constructor tsd-parent-kind-class"><a href="Dstore.html#constructor" class="tsd-kind-icon">constructor</a></li></ul></section><section class="tsd-index-section "><h3>Properties</h3><ul class="tsd-index-list"><li class="tsd-kind-property tsd-parent-kind-class"><a href="Dstore.html#datastore" class="tsd-kind-icon">datastore</a></li><li class="tsd-kind-property tsd-parent-kind-class"><a href="Dstore.html#logger" class="tsd-kind-icon">logger</a></li><li class="tsd-kind-property tsd-parent-kind-class"><a href="Dstore.html#projectId" class="tsd-kind-icon">project<wbr/>Id</a></li><li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><a href="Dstore.html#urlSaveKey" class="tsd-kind-icon">url<wbr/>Save<wbr/>Key</a></li></ul></section><section class="tsd-index-section "><section class="tsd-index-section"><h3>Methods Additional</h3><ul class="tsd-index-list"><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#readKey" class="tsd-kind-icon">read<wbr/>Key</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#set" class="tsd-kind-icon">set</a></li></ul></section><section class="tsd-index-section"><h3>Methods Datastore Drop-In</h3><ul class="tsd-index-list"><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#createQuery" class="tsd-kind-icon">create<wbr/>Query</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#delete" class="tsd-kind-icon">delete</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#get" class="tsd-kind-icon">get</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#getMulti" class="tsd-kind-icon">get<wbr/>Multi</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#insert" class="tsd-kind-icon">insert</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#key" class="tsd-kind-icon">key</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#keyFromSerialized" class="tsd-kind-icon">key<wbr/>From<wbr/>Serialized</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#keySerialize" class="tsd-kind-icon">key<wbr/>Serialize</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#save" class="tsd-kind-icon">save</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#update" class="tsd-kind-icon">update</a></li></ul></section><section class="tsd-index-section"><h3>Methods Other</h3><ul class="tsd-index-list"><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#allocateOneId" class="tsd-kind-icon">allocate<wbr/>One<wbr/>Id</a></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><a href="Dstore.html#fixKeys" class="tsd-kind-icon">fix<wbr/>Keys</a></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><a href="Dstore.html#getDoT" class="tsd-kind-icon">get<wbr/>DoT</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#query" class="tsd-kind-icon">query</a></li><li class="tsd-kind-method tsd-parent-kind-class tsd-has-type-parameter"><a href="Dstore.html#runInTransaction" class="tsd-kind-icon">run<wbr/>In<wbr/>Transaction</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#runQuery" class="tsd-kind-icon">run<wbr/>Query</a></li></ul></section></section></div></section></section><section class="tsd-panel-group tsd-member-group "><h2>Constructors</h2><section class="tsd-panel tsd-member tsd-kind-constructor tsd-parent-kind-class"><a id="constructor" class="tsd-anchor"></a><h3>constructor</h3><ul class="tsd-signatures tsd-kind-constructor tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">new <wbr/>Dstore<span class="tsd-signature-symbol">(</span>datastore<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Datastore</span>, projectId<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">string</span>, logger<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><a href="Dstore.html" class="tsd-signature-type" data-tsd-kind="Class">Dstore</a></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><ul><li>Defined in src/lib/dstore-api.ts:196</li></ul></aside><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>datastore: <span class="tsd-signature-type">Datastore</span></h5></li><li><h5><span class="tsd-flag ts-flagOptional">Optional</span> projectId: <span class="tsd-signature-type">string</span></h5></li><li><h5><span class="tsd-flag ts-flagOptional">Optional</span> logger: <span class="tsd-signature-type">string</span></h5></li></ul><h4 class="tsd-returns-title">Returns <a href="Dstore.html" class="tsd-signature-type" data-tsd-kind="Class">Dstore</a></h4></li></ul></section></section><section class="tsd-panel-group tsd-member-group "><h2>Properties</h2><section class="tsd-panel tsd-member tsd-kind-property tsd-parent-kind-class"><a id="datastore" class="tsd-anchor"></a><h3><span class="tsd-flag ts-flagReadonly">Readonly</span> datastore</h3><div class="tsd-signature tsd-kind-icon">datastore<span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Datastore</span></div><aside class="tsd-sources"><p>Implementation of IDstore.datastore</p></aside></section><section class="tsd-panel tsd-member tsd-kind-property tsd-parent-kind-class"><a id="logger" class="tsd-anchor"></a><h3><span class="tsd-flag ts-flagOptional">Optional</span> <span class="tsd-flag ts-flagReadonly">Readonly</span> logger</h3><div class="tsd-signature tsd-kind-icon">logger<span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">string</span></div></section><section class="tsd-panel tsd-member tsd-kind-property tsd-parent-kind-class"><a id="projectId" class="tsd-anchor"></a><h3><span class="tsd-flag ts-flagOptional">Optional</span> <span class="tsd-flag ts-flagReadonly">Readonly</span> project<wbr/>Id</h3><div class="tsd-signature tsd-kind-icon">project<wbr/>Id<span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">string</span></div></section><section class="tsd-panel tsd-member tsd-kind-property tsd-parent-kind-class tsd-is-private"><a id="urlSaveKey" class="tsd-anchor"></a><h3><span class="tsd-flag ts-flagPrivate">Private</span> <span class="tsd-flag ts-flagReadonly">Readonly</span> url<wbr/>Save<wbr/>Key</h3><div class="tsd-signature tsd-kind-icon">url<wbr/>Save<wbr/>Key<span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">URLSafeKey</span><span class="tsd-signature-symbol"> = ...</span></div><aside class="tsd-sources"><ul><li>Defined in src/lib/dstore-api.ts:194</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>Generate a Dstore instance for a specific [[Datastore]] instance.</p>
</div><div><pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">dstore</span><span class="hl-1"> = </span><span class="hl-3">Dstore</span><span class="hl-1">(</span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Datastore</span><span class="hl-1">())</span>
</code></pre>
<p>You are encouraged to provide the second parameter to provide the ProjectID. This makes <a href="Dstore.html#keySerialize">keySerialize</a> more robust. Usually you can get this from the Environment:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">dstore</span><span class="hl-1"> = </span><span class="hl-3">Dstore</span><span class="hl-1">(</span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Datastore</span><span class="hl-1">(), </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-2">GCLOUD_PROJECT</span><span class="hl-1">)</span><br/><br/><span class="hl-1">@</span><span class="hl-4">param</span><span class="hl-1"> </span><span class="hl-4">datastore</span><span class="hl-1"> </span><span class="hl-2">A</span><span class="hl-1"> [[</span><span class="hl-4">Datastore</span><span class="hl-1">]] </span><span class="hl-4">instance</span><span class="hl-1">. </span><span class="hl-4">Can</span><span class="hl-1"> </span><span class="hl-4">be</span><span class="hl-1"> </span><span class="hl-4">freely</span><span class="hl-1"> </span><span class="hl-4">accessed</span><span class="hl-1"> </span><span class="hl-4">by</span><span class="hl-1"> </span><span class="hl-4">the</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">. </span><span class="hl-4">Be</span><span class="hl-1"> </span><span class="hl-4">aware</span><span class="hl-1"> </span><span class="hl-4">that</span><span class="hl-1"> </span><span class="hl-4">using</span><span class="hl-1"> </span><span class="hl-0">this</span><span class="hl-1"> </span><span class="hl-4">inside</span><span class="hl-1"> &lt;</span><span class="hl-4">a</span><span class="hl-1"> </span><span class="hl-4">href</span><span class="hl-1">=</span><span class="hl-5">&quot;Dstore.html#runInTransaction&quot;</span><span class="hl-1">&gt;</span><span class="hl-4">runInTransaction</span><span class="hl-1">&lt;/</span><span class="hl-4">a</span><span class="hl-1">&gt; </span><span class="hl-4">ignores</span><span class="hl-1"> </span><span class="hl-4">the</span><span class="hl-1"> </span><span class="hl-4">transaction</span><span class="hl-1">.</span><br/><span class="hl-1">@</span><span class="hl-4">param</span><span class="hl-1"> </span><span class="hl-4">projectId</span><span class="hl-1"> </span><span class="hl-4">The</span><span class="hl-1"> </span><span class="hl-5">`GCLOUD_PROJECT ID`</span><span class="hl-1">. </span><span class="hl-4">Used</span><span class="hl-1"> </span><span class="hl-4">for</span><span class="hl-1"> </span><span class="hl-4">Key</span><span class="hl-1"> </span><span class="hl-4">generation</span><span class="hl-1"> </span><span class="hl-4">during</span><span class="hl-1"> </span><span class="hl-4">serialization</span><span class="hl-1">.</span>
</code></pre>
</div></div></section></section><section class="tsd-panel-group tsd-member-group "><h2>Additional Methods</h2><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="readKey" class="tsd-anchor"></a><h3>read<wbr/>Key</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">read<wbr/>Key<span class="tsd-signature-symbol">(</span>ent<span class="tsd-signature-symbol">: </span><a href="../modules.html#DstoreEntry" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreEntry</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Key</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.readKey</p><ul><li>Defined in src/lib/dstore-api.ts:252</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p><code>readKey()</code> extracts the [[Key]] from an <a href="../modules.html#DstoreEntry">DstoreEntry</a>.</p>
</div><div><p>Is is an alternative to <code>entity[Datastore.KEY]</code> which tends to fail in various contexts and also confuses older Typescript compilers.
It can extract the [[Key]] form a <a href="../modules.html#DstoreEntry">DstoreEntry</a> which has been serialized to JSON by leveraging the property <code>_keyStr</code>.</p>
</div></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>ent: <a href="../modules.html#DstoreEntry" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreEntry</a></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Key</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="set" class="tsd-anchor"></a><h3>set</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">set<span class="tsd-signature-symbol">(</span>key<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Key</span>, data<span class="tsd-signature-symbol">: </span><a href="../modules.html#DstoreEntry" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreEntry</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Key</span><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.set</p><ul><li>Defined in src/lib/dstore-api.ts:356</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p><code>set()</code> is addition to [[Datastore]]. It provides a classic Key-value Interface.</p>
</div><div><p>Instead providing a nested <a href="../modules.html#DstoreSaveEntity">DstoreSaveEntity</a> to <a href="Dstore.html#save">save</a> you can call set directly as <code>set( key, value)</code>.
Observe that set takes a [[Key]] as first parameter. you call it like this;</p>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">ds</span><span class="hl-1"> = </span><span class="hl-3">Dstore</span><span class="hl-1">()</span><br/><span class="hl-4">ds</span><span class="hl-1">.</span><span class="hl-3">set</span><span class="hl-1">(</span><span class="hl-4">ds</span><span class="hl-1">.</span><span class="hl-3">key</span><span class="hl-1">(</span><span class="hl-5">&#39;kind&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;123&#39;</span><span class="hl-1">), {</span><span class="hl-4">props1:</span><span class="hl-1"> </span><span class="hl-5">&#39;foo&#39;</span><span class="hl-1">, </span><span class="hl-4">prop2:</span><span class="hl-1"> </span><span class="hl-5">&#39;bar&#39;</span><span class="hl-1">})</span>
</code></pre>
<p>It returns the [[Key]] of the Object being written.
If the Key provided was an incomplete [[Key]] it will return a completed [[Key]].
See <a href="Dstore.html#save">save</a> for more information on key generation.</p>
</div></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>key: <span class="tsd-signature-type">Key</span></h5></li><li><h5>data: <a href="../modules.html#DstoreEntry" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreEntry</a></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Key</span><span class="tsd-signature-symbol">&gt;</span></h4></li></ul></section></section><section class="tsd-panel-group tsd-member-group "><h2>Datastore Drop-In Methods</h2><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="createQuery" class="tsd-anchor"></a><h3>create<wbr/>Query</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">create<wbr/>Query<span class="tsd-signature-symbol">(</span>kind<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Query</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.createQuery</p><ul><li>Defined in src/lib/dstore-api.ts:492</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p><code>createQuery()</code> creates an &quot;empty&quot; [[Query]] Object.</p>
</div><div><p>Compatible to <a href="https://cloud.google.com/nodejs/docs/reference/datastore/latest/datastore/datastore#_google_cloud_datastore_Datastore_createQuery_member_1_">createQuery</a> in the datastore.</p>
</div></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>kind: <span class="tsd-signature-type">string</span></h5><div class="tsd-comment tsd-typography"><div class="lead">
<p>Name of the [[Datastore]]<a href="https://cloud.google.com/datastore/docs/concepts/entities#kinds_and_identifiers">Kind</a> (&quot;Table&quot;) which should be searched.</p>
</div></div></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Query</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="delete" class="tsd-anchor"></a><h3>delete</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">delete<span class="tsd-signature-symbol">(</span>keys<span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">readonly </span><span class="tsd-signature-type">Key</span><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">CommitResponse</span><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.delete</p><ul><li>Defined in src/lib/dstore-api.ts:472</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p><code>delete()</code> is compatible to [Datastore.update()].</p>
</div><div><p>Unfortunately currently (late 2021) there is no formal documentation from Google on [Datastore.update()].</p>
<p>The single Parameter is a list of [[Key]]s.
If called within a transaction it returns <code>undefined</code>.
If not, it returns a [[CommitResponse]] which is not documented by Google.</p>
<p><code>delete()</code> is idempotent. Deleting the same [[Key]] twice is no error.</p>
</div><dl class="tsd-comment-tags"><dt>throws</dt><dd><p><a href="DstoreError.html">DstoreError</a></p>
</dd></dl></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>keys: <span class="tsd-signature-symbol">readonly </span><span class="tsd-signature-type">Key</span><span class="tsd-signature-symbol">[]</span></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">CommitResponse</span><span class="tsd-signature-symbol">&gt;</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="get" class="tsd-anchor"></a><h3>get</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">get<span class="tsd-signature-symbol">(</span>key<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Key</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../modules.html#DstoreEntry" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreEntry</a><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.get</p><ul><li>Defined in src/lib/dstore-api.ts:301</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p><code>get()</code> reads a <a href="../modules.html#DstoreEntry">DstoreEntry</a> from the Datastore.</p>
</div><div><p>It returns <a href="../modules.html#DstoreEntry">DstoreEntry</a> or <code>null</code> if not found.</p>
<p>The underlying Datastore API Call is <a href="https://cloud.google.com/datastore/docs/reference/data/rest/v1/projects/lookup">lookup</a>.</p>
<p>It is in the Spirit of [Datastore.get()]. Unfortunately currently (late 2021) there is no formal documentation from Google on [Datastore.get()].</p>
<p>Differences between <a href="Dstore.html#get">Dstore.get</a> and [[Datastore.get]]:</p>
<ul>
<li>[Dstore.get]] takes a single [[Key]] as Parameter, no Array. Check <a href="Dstore.html#getMulti">getMulti</a> if you want Arrays.</li>
<li>[Dstore.get]] returns a single <a href="../modules.html#DstoreEntry">DstoreEntry</a>, no Array.</li>
</ul>
</div></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>key: <span class="tsd-signature-type">Key</span></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../modules.html#DstoreEntry" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreEntry</a><span class="tsd-signature-symbol">&gt;</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="getMulti" class="tsd-anchor"></a><h3>get<wbr/>Multi</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">get<wbr/>Multi<span class="tsd-signature-symbol">(</span>keys<span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">readonly </span><span class="tsd-signature-type">Key</span><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-symbol">readonly </span><a href="../modules.html#DstoreEntry" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreEntry</a><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.getMulti</p><ul><li>Defined in src/lib/dstore-api.ts:324</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p><code>getMulti()</code> reads several <a href="../modules.html#DstoreEntry">DstoreEntry</a>s from the Datastore.</p>
</div><div><p>It returns a list of <a href="../modules.html#DstoreEntry">DstoreEntry</a>s or <code>null</code> if not found.</p>
<p>The underlying Datastore API Call is <a href="https://cloud.google.com/datastore/docs/reference/data/rest/v1/projects/lookup">lookup</a>.</p>
<p>It is in the Spirit of [Datastore.get()]. Unfortunately currently (late 2021) there is no formal documentation from Google on [Datastore.get()].</p>
<p>Differences between <a href="Dstore.html#getMulti">Dstore.getMulti</a> and [[Datastore.get]]:</p>
<ul>
<li><a href="Dstore.html#getMulti">Dstore.getMulti</a> always takes an Array of [[Key]]s as Parameter.</li>
<li><a href="Dstore.html#getMulti">Dstore.getMulti</a> returns always a Array of <a href="../modules.html#DstoreEntry">DstoreEntry</a>, or null.</li>
<li>[[Datastore.get]] has many edge cases - e.g. when not being able to find any of the provided keys - which return surprising results. <a href="Dstore.html#getMulti">Dstore.getMulti</a> always returns an Array. TODO: return a Array with the same length as the Input.</li>
</ul>
</div></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>keys: <span class="tsd-signature-symbol">readonly </span><span class="tsd-signature-type">Key</span><span class="tsd-signature-symbol">[]</span></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-symbol">readonly </span><a href="../modules.html#DstoreEntry" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreEntry</a><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">&gt;</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="insert" class="tsd-anchor"></a><h3>insert</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">insert<span class="tsd-signature-symbol">(</span>entities<span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">readonly </span><a href="../modules.html#DstoreSaveEntity" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreSaveEntity</a><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">CommitResponse</span><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.insert</p><ul><li>Defined in src/lib/dstore-api.ts:416</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p><code>insert()</code> is compatible to <a href="https://cloud.google.com/nodejs/docs/reference/datastore/latest/datastore/datastore#_google_cloud_datastore_Datastore_insert_member_1_">Datastore.insert()</a>.</p>
</div><div><p>The single Parameter is a list of <a href="../modules.html#DstoreSaveEntity">DstoreSaveEntity</a>s.
If called within a transaction it returns <code>undefined</code>.
If not, it returns a [[CommitResponse]] which is not documented by Google.</p>
<p><code>insert()</code> seems to be like <a href="Dstore.html#save">save</a> where [[DstoreSaveEntity.method]] is set to <code>&#39;insert&#39;</code>. It throws an <a href="DstoreError.html">DstoreError</a> if there is already a Entity with the same [[Key]] in the Datastore.</p>
<p>For handling of incomplete [[Key]]s see <a href="Dstore.html#save">save</a>.</p>
</div><dl class="tsd-comment-tags"><dt>throws</dt><dd><p><a href="DstoreError.html">DstoreError</a></p>
</dd></dl></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>entities: <span class="tsd-signature-symbol">readonly </span><a href="../modules.html#DstoreSaveEntity" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreSaveEntity</a><span class="tsd-signature-symbol">[]</span></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">CommitResponse</span><span class="tsd-signature-symbol">&gt;</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="key" class="tsd-anchor"></a><h3>key</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">key<span class="tsd-signature-symbol">(</span>path<span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">readonly </span><span class="tsd-signature-type">PathType</span><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Key</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.key</p><ul><li>Defined in src/lib/dstore-api.ts:219</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p><code>key()</code> creates a [[Key]] Object from a path.</p>
</div><div><p>Compatible to <a href="https://cloud.google.com/nodejs/docs/reference/datastore/latest/datastore/datastore#_google_cloud_datastore_Datastore_key_member_1_">Datastore.key</a></p>
<p>If the Path has an odd number of elements, it is considered an incomplete Key. This can only be used for saving and will prompt the Datastore to auto-generate an (random) ID. See also <a href="Dstore.html#save">save</a>.</p>
</div></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>path: <span class="tsd-signature-symbol">readonly </span><span class="tsd-signature-type">PathType</span><span class="tsd-signature-symbol">[]</span></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Key</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="keyFromSerialized" class="tsd-anchor"></a><h3>key<wbr/>From<wbr/>Serialized</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">key<wbr/>From<wbr/>Serialized<span class="tsd-signature-symbol">(</span>text<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Key</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.keyFromSerialized</p><ul><li>Defined in src/lib/dstore-api.ts:241</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p><code>keyFromSerialized()</code> deserializes a string created with <a href="Dstore.html#keySerialize">keySerialize</a> to a [[Key]].</p>
</div><div><p>Compatible to <a href="https://cloud.google.com/nodejs/docs/reference/datastore/latest/datastore/datastore#_google_cloud_datastore_Datastore_keyFromLegacyUrlsafe_member_1_">keyFromLegacyUrlsafe</a>.</p>
</div></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>text: <span class="tsd-signature-type">string</span></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Key</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="keySerialize" class="tsd-anchor"></a><h3>key<wbr/>Serialize</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">key<wbr/>Serialize<span class="tsd-signature-symbol">(</span>key<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Key</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.keySerialize</p><ul><li>Defined in src/lib/dstore-api.ts:231</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p><code>keyFromSerialized()</code> serializes [[Key]] to a string.</p>
</div><div><p>Compatible to <a href="https://cloud.google.com/nodejs/docs/reference/datastore/latest/datastore/datastore#_google_cloud_datastore_Datastore_keyToLegacyUrlSafe_member_1_">keyToLegacyUrlSafe</a>, but does not support the &quot;locationPrefix&quot; since the use for this parameter is undocumented and unknown. It seems to be an artifact from early App Engine days.</p>
<p>It can be a synchronous function because it does not look up the <code>projectId</code>. Instead it is assumed, that you give the <code>projectId</code> upon instantiation of <a href="Dstore.html">Dstore</a>. It also seems, that a wrong <code>projectId</code> bears no ill effects.</p>
</div></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>key: <span class="tsd-signature-type">Key</span></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">string</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="save" class="tsd-anchor"></a><h3>save</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">save<span class="tsd-signature-symbol">(</span>entities<span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">readonly </span><a href="../modules.html#DstoreSaveEntity" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreSaveEntity</a><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">CommitResponse</span><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.save</p><ul><li>Defined in src/lib/dstore-api.ts:383</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p><code>save()</code> is compatible to <a href="https://cloud.google.com/nodejs/docs/reference/datastore/latest/datastore/datastore#_google_cloud_datastore_Datastore_save_member_1_">Datastore.save()</a>.</p>
</div><div><p>The single Parameter is a list of <a href="../modules.html#DstoreSaveEntity">DstoreSaveEntity</a>s.
If called within a transaction it returns <code>undefined</code>.
If not, it returns a [[CommitResponse]] which is not documented by Google.</p>
<p>Different [DstoreSaveEntity]]s in the <code>entities</code> parameter can have different values in their [[DstoreSaveEntity.method]] property.
This allows you to do <code>insert</code>, <code>update</code> and <code>upsert</code> (the default) in a single request.</p>
<p><code>save()</code> seems to basically be an alias to <a href="https://cloud.google.com/nodejs/docs/reference/datastore/latest/datastore/datastore#_google_cloud_datastore_Datastore_upsert_member_1_">upsert</a>.</p>
<p>If the [[Key]] provided in [[DstoreSaveEntity.key]] was an incomplete [[Key]] it will be updated by <code>save()</code> inside the <a href="../modules.html#DstoreSaveEntity">DstoreSaveEntity</a>.</p>
<p>If the Datastore generates a new ID because of an incomplete [[Key]] <em>on first save</em> it will return an large integer as [[Key.id]].
On every subsequent <code>save()</code> an string encoded number representation is returned.
Dstore normalizes that and always returns an string encoded number representation.</p>
</div></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>entities: <span class="tsd-signature-symbol">readonly </span><a href="../modules.html#DstoreSaveEntity" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreSaveEntity</a><span class="tsd-signature-symbol">[]</span></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">CommitResponse</span><span class="tsd-signature-symbol">&gt;</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="update" class="tsd-anchor"></a><h3>update</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">update<span class="tsd-signature-symbol">(</span>entities<span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">readonly </span><a href="../modules.html#DstoreSaveEntity" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreSaveEntity</a><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">CommitResponse</span><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.update</p><ul><li>Defined in src/lib/dstore-api.ts:445</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p><code>update()</code> is compatible to <a href="https://cloud.google.com/nodejs/docs/reference/datastore/latest/datastore/datastore#_google_cloud_datastore_Datastore_update_member_1_">Datastore.update()</a>.</p>
</div><div><p>The single Parameter is a list of <a href="../modules.html#DstoreSaveEntity">DstoreSaveEntity</a>s.
If called within a transaction it returns <code>undefined</code>.
If not, it returns a [[CommitResponse]] which is not documented by Google.</p>
<p><code>update()</code> seems to be like <a href="Dstore.html#save">save</a> where [[DstoreSaveEntity.method]] is set to <code>&#39;update&#39;</code>.
It throws an <a href="DstoreError.html">DstoreError</a> if there is no Entity with the same [[Key]] in the Datastore. <code>update()</code> <em>overwrites all existing data</em> for that [[Key]].
There was an alpha functionality called <code>merge()</code> in the Datastore which read an Entity, merged it with the new data and wrote it back, but this was never documented.</p>
<p><code>update()</code> is idempotent. Deleting the same [[Key]] twice is no error.</p>
</div><dl class="tsd-comment-tags"><dt>throws</dt><dd><p><a href="DstoreError.html">DstoreError</a></p>
</dd></dl></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>entities: <span class="tsd-signature-symbol">readonly </span><a href="../modules.html#DstoreSaveEntity" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreSaveEntity</a><span class="tsd-signature-symbol">[]</span></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">CommitResponse</span><span class="tsd-signature-symbol">&gt;</span></h4></li></ul></section></section><section class="tsd-panel-group tsd-member-group "><h2>Other Methods</h2><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="allocateOneId" class="tsd-anchor"></a><h3>allocate<wbr/>One<wbr/>Id</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">allocate<wbr/>One<wbr/>Id<span class="tsd-signature-symbol">(</span>kindName<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.allocateOneId</p><ul><li>Defined in src/lib/dstore-api.ts:540</li></ul></aside><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>kindName: <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol"> = &#39;Numbering&#39;</span></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class tsd-is-private"><a id="fixKeys" class="tsd-anchor"></a><h3><span class="tsd-flag ts-flagPrivate">Private</span> fix<wbr/>Keys</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class tsd-is-private"><li class="tsd-signature tsd-kind-icon">fix<wbr/>Keys<span class="tsd-signature-symbol">(</span>entities<span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">readonly </span><span class="tsd-signature-type">Partial</span><span class="tsd-signature-symbol">&lt;</span><a href="../modules.html#DstoreEntry" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreEntry</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><a href="../modules.html#DstoreEntry" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreEntry</a><span class="tsd-signature-symbol">[]</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><ul><li>Defined in src/lib/dstore-api.ts:272</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p><code>fixKeys()</code> is called for all <a href="../modules.html#DstoreEntry">DstoreEntry</a>sa returned from <a href="Dstore.html">Dstore</a>.</p>
</div><div><p>Is ensures that besides <code>entity[Datastore.KEY]</code> there is <code>_keyStr</code> to be leveraged by <a href="Dstore.html#readKey">readKey</a>.</p>
</div><dl class="tsd-comment-tags"><dt>internal</dt><dd></dd></dl></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>entities: <span class="tsd-signature-symbol">readonly </span><span class="tsd-signature-type">Partial</span><span class="tsd-signature-symbol">&lt;</span><a href="../modules.html#DstoreEntry" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreEntry</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">[]</span></h5></li></ul><h4 class="tsd-returns-title">Returns <a href="../modules.html#DstoreEntry" class="tsd-signature-type" data-tsd-kind="Type alias">DstoreEntry</a><span class="tsd-signature-symbol">[]</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class tsd-is-private"><a id="getDoT" class="tsd-anchor"></a><h3><span class="tsd-flag ts-flagPrivate">Private</span> get<wbr/>DoT</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class tsd-is-private"><li class="tsd-signature tsd-kind-icon">get<wbr/>DoT<span class="tsd-signature-symbol">(</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Datastore</span><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">Transaction</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><ul><li>Defined in src/lib/dstore-api.ts:205</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>Gets the Datastore or the current Transaction.</p>
</div></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Datastore</span><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">Transaction</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="query" class="tsd-anchor"></a><h3>query</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">query<span class="tsd-signature-symbol">(</span>kindName<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span>, filters<span class="tsd-signature-symbol">?: </span><a href="../modules.html#TGqlFilterList" class="tsd-signature-type" data-tsd-kind="Type alias">TGqlFilterList</a>, limit<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">number</span>, orders<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-symbol">readonly </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">RunQueryResponse</span><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.query</p><ul><li>Defined in src/lib/dstore-api.ts:506</li></ul></aside><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>kindName: <span class="tsd-signature-type">string</span></h5></li><li><h5>filters: <a href="../modules.html#TGqlFilterList" class="tsd-signature-type" data-tsd-kind="Type alias">TGqlFilterList</a><span class="tsd-signature-symbol"> = []</span></h5></li><li><h5>limit: <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 2500</span></h5></li><li><h5>orders: <span class="tsd-signature-symbol">readonly </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol"> = []</span></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">RunQueryResponse</span><span class="tsd-signature-symbol">&gt;</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class tsd-has-type-parameter"><a id="runInTransaction" class="tsd-anchor"></a><h3>run<wbr/>In<wbr/>Transaction</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class tsd-has-type-parameter"><li class="tsd-signature tsd-kind-icon">run<wbr/>In<wbr/>Transaction<span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type" data-tsd-kind="Type parameter">T</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">(</span>func<span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">(</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol"> =&gt; </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type" data-tsd-kind="Type parameter">T</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type" data-tsd-kind="Type parameter">T</span><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.runInTransaction</p><ul><li>Defined in src/lib/dstore-api.ts:561</li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>This tries to give high level access to transactions.</p>
</div><div><p>Be aware that Transactions differ considerable between Master-Slave Datastore (very old), High Replication Datastore (old, later called <a href="https://cloud.google.com/datastore/docs/concepts/cloud-datastore-transactions">Google Cloud Datastore</a>) and <a href="https://cloud.google.com/datastore/docs/firestore-or-datastore#in_datastore_mode">Firestore in Datastore Mode</a> (current).</p>
<p>So called &quot;Gross Group Transactions&quot; are always enabled. Transactions are never Cross Project. <code>runInTransaction()</code> works only if you use the same [[KvStore] instance for all access within the Transaction.</p>
<p><a href="Dstore.html#runInTransaction">runInTransaction</a> is modelled after Python 2.7 <a href="https://cloud.google.com/appengine/docs/standard/python/ndb/transactions">ndb&#39;s <code>@ndb.transactional</code> feature</a>. This is based on node&#39;s <a href="https://nodejs.org/docs/latest-v14.x/api/async_hooks.html">AsyncLocalStorage</a>.</p>
<p>Transactions frequently fail if you try to access the same data via in a transaction. See the <a href="https://cloud.google.com/datastore/docs/concepts/transactions#transaction_locks">Documentation on Locking</a> for further reference. You are advised to use <a href="https://github.com/sindresorhus/p-limit">p-limit</a>(1) to seralize transactions touching the same resource. This should work nicely with node&#39;s single process model. It is a much bigger problem on shared-nothing approaches, like Python on App Engine.</p>
<p>Transactions might be wrapped in <a href="https://github.com/sindresorhus/p-retry">p-retry</a> to implement automatically retrying them with exponential back-off should they fail due to contention.</p>
</div></div><h4 class="tsd-type-parameters-title">Type parameters</h4><ul class="tsd-type-parameters"><li><h4>T</h4></li></ul><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>func: <span class="tsd-signature-symbol">(</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol"> =&gt; </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type" data-tsd-kind="Type parameter">T</span><span class="tsd-signature-symbol">&gt;</span></h5><ul class="tsd-parameters"><li class="tsd-parameter-signature"><ul class="tsd-signatures tsd-kind-type-literal"><li class="tsd-signature tsd-kind-icon"><span class="tsd-signature-symbol">(</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type" data-tsd-kind="Type parameter">T</span><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type" data-tsd-kind="Type parameter">T</span><span class="tsd-signature-symbol">&gt;</span></h4></li></ul></li></ul></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type" data-tsd-kind="Type parameter">T</span><span class="tsd-signature-symbol">&gt;</span></h4></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="runQuery" class="tsd-anchor"></a><h3>run<wbr/>Query</h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">run<wbr/>Query<span class="tsd-signature-symbol">(</span>query<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Query</span><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">Omit</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Query</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">&quot;run&quot;</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">RunQueryResponse</span><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><p>Implementation of IDstore.runQuery</p><ul><li>Defined in src/lib/dstore-api.ts:496</li></ul></aside><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>query: <span class="tsd-signature-type">Query</span><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">Omit</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Query</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">&quot;run&quot;</span><span class="tsd-signature-symbol">&gt;</span></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">RunQueryResponse</span><span class="tsd-signature-symbol">&gt;</span></h4></li></ul></section></section></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class=""><a href="../modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="current tsd-kind-class"><a href="Dstore.html" class="tsd-kind-icon">Dstore</a><ul><li class="tsd-kind-constructor tsd-parent-kind-class"><a href="Dstore.html#constructor" class="tsd-kind-icon">constructor</a></li><li class="tsd-kind-property tsd-parent-kind-class"><a href="Dstore.html#datastore" class="tsd-kind-icon">datastore</a></li><li class="tsd-kind-property tsd-parent-kind-class"><a href="Dstore.html#logger" class="tsd-kind-icon">logger</a></li><li class="tsd-kind-property tsd-parent-kind-class"><a href="Dstore.html#projectId" class="tsd-kind-icon">project<wbr/>Id</a></li><li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><a href="Dstore.html#urlSaveKey" class="tsd-kind-icon">url<wbr/>Save<wbr/>Key</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#allocateOneId" class="tsd-kind-icon">allocate<wbr/>One<wbr/>Id</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#createQuery" class="tsd-kind-icon">create<wbr/>Query</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#delete" class="tsd-kind-icon">delete</a></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><a href="Dstore.html#fixKeys" class="tsd-kind-icon">fix<wbr/>Keys</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#get" class="tsd-kind-icon">get</a></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><a href="Dstore.html#getDoT" class="tsd-kind-icon">get<wbr/>DoT</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#getMulti" class="tsd-kind-icon">get<wbr/>Multi</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#insert" class="tsd-kind-icon">insert</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#key" class="tsd-kind-icon">key</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#keyFromSerialized" class="tsd-kind-icon">key<wbr/>From<wbr/>Serialized</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#keySerialize" class="tsd-kind-icon">key<wbr/>Serialize</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#query" class="tsd-kind-icon">query</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#readKey" class="tsd-kind-icon">read<wbr/>Key</a></li><li class="tsd-kind-method tsd-parent-kind-class tsd-has-type-parameter"><a href="Dstore.html#runInTransaction" class="tsd-kind-icon">run<wbr/>In<wbr/>Transaction</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#runQuery" class="tsd-kind-icon">run<wbr/>Query</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#save" class="tsd-kind-icon">save</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#set" class="tsd-kind-icon">set</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="Dstore.html#update" class="tsd-kind-icon">update</a></li></ul></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="../assets/main.js"></script></body></html>